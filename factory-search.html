<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>factory-search</title>
<script src="jquery.js"></script>
<script src="factory.js"></script>
<script src="damage.js"></script>
<script>
$(function () {
	initialize_factory(function () {
		var ng_items = ["ひかりのこな", "きあいのハチマキ", "せんせいのツメ", "きあいのタスキ", "のんきのおこう"];
		var ng_abilities = [];
		var rathi = gen_poke(RANK_OPEN_8, true, factory_data[933], 0);
		var rai = gen_poke(RANK_OPEN_8, true, factory_data[788], 0);
		var my = rathi;
		// ムクホで倒せない相手
		var targets = [352,353,355,356,357,359,361,362,363,364,366,367,370,371,372,373,375,378,380,381,382,383,386,390,391,392,393,395,396,397,398,399,400,401,402,403,407,408,409,411,412,413,414,417,418,419,420,421,422,423,424,425,426,427,429,430,431,432,433,434,436,439,440,441,442,443,444,445,446,447,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,472,473,476,477,478,480,481,482,483,484,485,486,488,489,492,493,494,495,497,498,499,500,502,503,504,506,507,508,509,510,511,514,516,517,519,522,527,528,529,531,532,533,534,535,536,537,538,539,543,544,545,547,548,550,552,553,554,555,556,557,562,563,564,565,566,567,568,569,570,571,572,575,576,577,579,580,581,583,584,586,587,588,589,591,592,593,596,597,598,599,600,601,602,603,604,605,607,608,609,612,613,614,615,616,617,618,619,620,621,622,624,625,627,628,629,631,632,633,634,635,636,638,639,642,643,644,645,647,650,651,652,653,654,655,658,663,664,665,667,668,669,670,671,672,673,675,676,679,681,682,683,684,685,686,689,690,691,692,694,699,702,703,704,705,706,707,708,711,712,713,714,715,716,717,719,721,722,723,724,725,727,728,730,732,733,735,736,737,738,739,740,741,744,745,746,747,749,750,752,753,754,755,756,757,758,760,761,762,763,764,765,767,768,769,770,771,772,774,775,778,779,780,781,783,786,788,789,790,791,793,794,798,799,800,801,803,804,805,806,807,808,809,810,811,815,817,818,819,820,821,822,825,826,827,828,831,833,834,835,836,837,838,839,840,841,842,843,844,847,848,849,850,851,852,853,855,858,859,860,861,863,864,865,866,868,869,870,871,872,873,874,875,876,877,878,880,881,882,884,885,886,888,889,890,891,892,893,894,895,896,897,898,899,900,901,903,905,906,907,908,909,910,911,912,913,914,915,916,917,918,919,920,921,922,923,924,926,927,928,929,930,931,932,933,934,935,936,937,938,940,941,942,943,944,945,946,947,948,949,950];

		var oks = 0;
		targets.forEach(function (i) {
			var target = gen_poke(RANK_OPEN_8, true, factory_data[i], 0);
			var dmg = 0;
			my.entry.move.forEach (function (waza) {
				dmg = Math.max(dmg, damage(my, waza_fromname[waza], i));
			});
			var damageOk = dmg >= target.hp;

			var speedOk = calcComputedSpeed(target) < calcComputedSpeed(my);
			var itemOk = ng_items.indexOf(target.item) < 0;
			var badAbility = target.entry.pokemon.abilities.filter(function(x) { return ng_abilities.indexOf(x) >= 0});
			var abilityOk = badAbility.length == 0;
			var ok = speedOk && damageOk && itemOk && abilityOk;

			var msg = target.name+":";
			msg += (speedOk ? "" : " speedNG("+calcComputedSpeed(target)+")");
			msg += (damageOk ? "" : " damageNG("+dmg+" / "+target.hp+")");
			msg += (itemOk ? "" : " itemNG("+target.item+")");
			msg += (abilityOk ? "" : " abilityNG("+badAbility.join(",")+")");
			msg += (ok ? " OK" : "");
			//console.log(msg);
			if (ok) oks ++;
		});
		console.log(oks);
	});
});

function damage(userPoke, waza, index) {
	// 2つの特性両方を試す
	var target = gen_poke(RANK_OPEN_8, true, factory_data[index], 0);
	var dmg1 = calcDamage(userPoke, target, waza);
	var target = gen_poke(RANK_OPEN_8, true, factory_data[index], 1);
	var dmg2 = calcDamage(userPoke, target, waza);
	return Math.min(dmg1, dmg2);
}

function check_mukuho() {
	var ng_items = ["きあいのハチマキ", "せんせいのツメ", "きあいのタスキ", "ひかりのこな", "のんきのおこう"];
	var ng_abilities = ["ゆうばく", "ほのおのからだ", "ほうし", "トレース", "いかく"]
	var mukuho = gen_poke(RANK_OPEN_8, true, factory_data[789], 0);
	var brave = waza_fromname[mukuho.entry.move[0]];
	for (var i = 351; i <= 950; i ++) {
		var target = gen_poke(RANK_OPEN_8, true, factory_data[i], 0);
		var dmg = damage(mukuho, brave, i);
		var damageOk = dmg >= target.hp;

		var speedOk = calcComputedSpeed(target) < calcComputedSpeed(mukuho);
		var itemOk = ng_items.indexOf(target.item) < 0;
		var badAbility = target.entry.pokemon.abilities.filter(function(x) { return ng_abilities.indexOf(x) >= 0 });
		var abilityOk = badAbility.length == 0;
		var ok = speedOk && damageOk && itemOk && abilityOk;

		var msg = target.name+":";
		msg += (speedOk ? "" : " speedNG("+calcComputedSpeed(target)+")");
		msg += (damageOk ? "" : " damageNG("+dmg+" / "+target.hp+")");
		msg += (itemOk ? "" : " itemNG("+target.item+")");
		msg += (abilityOk ? "" : " abilityNG("+badAbility.join(",")+")");
		msg += (ok ? " OK" : "");
		if (!ok) console.log(msg);
	}
}
</script>
</head>
<body>
</body>
</html>
